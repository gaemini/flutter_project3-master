<!DOCTYPE html>
<html>
<head>
    <title>Firebase Storage 이미지 URL 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        input[type="url"] { width: 80%; padding: 5px; }
        button { padding: 8px 15px; margin: 5px; }
        img { max-width: 300px; max-height: 200px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>🔍 Firebase Storage 이미지 URL 테스트</h1>
    
    <div class="test-section">
        <h3>1. 이미지 URL 직접 테스트</h3>
        <input type="url" id="imageUrl" placeholder="Firebase Storage 이미지 URL을 입력하세요">
        <button onclick="testImageUrl()">테스트</button>
        <div id="imageResult"></div>
    </div>

    <div class="test-section">
        <h3>2. 일반적인 403 오류 URL 패턴</h3>
        <p><strong>문제 URL 예시:</strong></p>
        <code>https://storage.googleapis.com/firebasestorage/v0/b/flutterproject3-af322.firebase.app/o/posts%2Fimage.jpg?alt=media</code>
        
        <p><strong>올바른 URL 예시:</strong></p>
        <code>https://firebasestorage.googleapis.com/v0/b/flutterproject3-af322.firebasestorage.app/o/posts%2Fimage.jpg?alt=media&token=YOUR_TOKEN</code>
    </div>

    <script>
        function testImageUrl() {
            const url = document.getElementById('imageUrl').value;
            const resultDiv = document.getElementById('imageResult');
            
            if (!url) {
                resultDiv.innerHTML = '<p class="error">URL을 입력해주세요.</p>';
                return;
            }
            
            resultDiv.innerHTML = '<p>테스트 중...</p>';
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                resultDiv.innerHTML = `
                    <p class="success">✅ 이미지 로딩 성공!</p>
                    <img src="${url}" alt="테스트 이미지">
                    <p><strong>URL:</strong> ${url}</p>
                `;
            };
            
            img.onerror = function() {
                fetch(url, { method: 'HEAD', mode: 'no-cors' })
                .then(() => {
                    resultDiv.innerHTML = `
                        <p class="error">❌ 이미지 로딩 실패 (CORS 또는 권한 문제)</p>
                        <p><strong>URL:</strong> ${url}</p>
                        <p><strong>추천 해결책:</strong></p>
                        <ul>
                            <li>Firebase Storage 규칙 확인</li>
                            <li>CORS 설정 확인</li>
                            <li>URL에 올바른 토큰 포함 여부 확인</li>
                        </ul>
                    `;
                })
                .catch(() => {
                    resultDiv.innerHTML = `
                        <p class="error">❌ 접근 불가 (403 오류 가능성 높음)</p>
                        <p><strong>URL:</strong> ${url}</p>
                    `;
                });
            };
            
            img.src = url;
        }
    </script>
</body>
</html>
